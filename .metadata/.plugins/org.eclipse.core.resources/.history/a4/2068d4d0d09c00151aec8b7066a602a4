package friday.todolist.implementation;

import java.util.ArrayList;
import java.util.Comparator;
import java.util.List;
import java.util.PriorityQueue;
import java.util.Set;
import java.util.TreeSet;

import friday.todolist.task.Task;

public class ToDoList {
	private PriorityQueue<Task> tasks;
	private int remainingTime;

	public ToDoList(int remainingTime) {
		this.remainingTime = remainingTime;
		// sort tasks by priority first and second by time needed
		tasks = new PriorityQueue<>(new Comparator<Task>() {
			@Override
			public int compare(Task task1, Task task2) {
				int compare = task1.getPriority() > task2.getPriority() ? -1
						: task1.getPriority() < task2.getPriority() ? 1 : 0;
				if (compare == 0) {
					return task1.getTimeNeeded() > task2.getTimeNeeded() ? 1
							: task1.getTimeNeeded() < task2.getTimeNeeded() ? -1
									: 0;
				}
				return compare;
			}
		});
	}

	public void addTask(Task task) {
		tasks.add(task);
	}

	private void reorderElements() {
		List<Task> backUp = new ArrayList<>();
		for (Task task : tasks) {
			backUp.add(task);
		}
		tasks.clear();
		for (Task task : backUp) {
			tasks.add(task);
		}
	}

	public void markFinished(Task t) {
		t.setTimeNeeded(0);
		t.setFinished(true);
		t.setPriority(0);
		reorderElements();
		System.out.println(t + " finished");
	}

	public void markCancelled(Task t) {
		tasks.remove(t);
		System.out.println(t + " canceled");
	}

	public boolean canFinish() {
		return remainingTime > getTimeNeeded();
	}

	public Task top() {
		System.out.print("Higher priority task ==> ");
		return tasks.peek();
	}

	public float getTimeNeeded() {
		float sum = 0;
		for (Task task : tasks) {
			sum += task.getTimeNeeded();
		}
		System.out
				.print("Time needed in order to finished all tasks in the lest: ");
		return sum;
	}

	public boolean changePriority(Task task, int priority) {
		if (priority < 1 || priority > 10) {
			System.err
					.println("Invalid priority value!Priority should be in the range 1-10");
			return false;
		}
		task.setPriority(priority);
		reorderElements();
		return true;

	}

	@Override
	public String toString() {
		PriorityQueue<Task> set = new PriorityQueue<>(tasks);
		System.out.println("\nYour tasks in the list");
		String str = "=====================================================\n";
		while (!set.isEmpty()) {
			str += set.poll() + "\n";

		}
		str += "=====================================================";
		return str;
	}
}
